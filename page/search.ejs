<%- include('header.ejs') %> 
    <h1>æ–‡ç« æœå°‹é </h1>

    <form>
        <input type="text" id="keyword" name="keyword" placeholder="åœ¨é€™è¼¸å…¥é—œéµå­—">
        <input type="submit" value="æœå°‹" >
    </form>

     <% if(data !=='N/A' && data.length >0) { %>
        <h1>å…±<%=data.length%>å€‹çµæœ</h1>
        <% data.forEach(article => { %>
            <h3><a href="/post/<%=article._id%>" target="_blank"><%=article.title%></a> (ç€è¦½æ¬¡æ•¸ : <%=article.views%>)</h3>
        <% }) %>
    <% } %>

    <div id="searchResult"></div>

    <script>
        const searchKeyword = document.querySelector('#keyword')
        const form = document.querySelector('form')
        const searchResult = document.querySelector('#searchResult')

        form.addEventListener('submit',(e)=>{
            e.preventDefault()
            fetchData()
        })
        
        async function fetchData() {

            const url = `http://localhost:3001/search?keyword=${searchKeyword.value}`
            
            console.log("ğŸš€ ~ fetchData ~ url:", url)

            try{
            const res = await fetch(url)
            const data = await res.json()
            console.log(data)

            if(data.length)
            {
                let newContent = `<p>å…±æœ‰${data.length}å€‹æœå°‹çµæœ</p>`
                data.forEach(result=>{
                    console.log(result)
                    newContent += `<a href="/post/${result._id}" target="_blank">${result.title}</a> (${result.views}æ¬¡ç€è¦½)<br/><br/>`
                })
                searchResult.innerHTML=newContent
            }
            else   {
                searchResult.innerHTML=`<p>æœå°‹æ²’æœ‰çµæœ</p>`

            }
            }
            catch(e){
                console.log('Fetch error '+e)
            }
        }

        /* const url = ';
        fetchData(url); */

    </script>
<%- include('footer.ejs') %> 